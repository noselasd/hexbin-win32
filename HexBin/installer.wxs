<?xml version='1.0' encoding='Windows-1252'?>

<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>
  <?define Version="1.1" ?>
  <?define FirstVersion="1.1.0" ?>
  <?define FullVersion="1.1.4" ?>
  <?define UpgradeCode="{F509B630-6997-4A87-8110-260C39334A7C}"?>
  <?define ProductCode="{389B4D77-940D-4D30-A12B-051D496E22A8}"?>

  <Product Name='HexBin 1.1' Id='$(var.ProductCode)' UpgradeCode='$(var.UpgradeCode)'
    Language='1033' Codepage='1252' Version='$(var.FullVersion)' Manufacturer='Nils O. Selåsdal'>

    <Package Id='*' Keywords='Installer' Description="HexBin ${var.Version} Installer"
      InstallerVersion='100' Languages='1033' Compressed='yes' SummaryCodepage='1252' />

    <Media Id='1' Cabinet='Sample.cab' EmbedCab='yes' DiskPrompt="CD-ROM #1" />
    <Property Id='DiskPrompt' Value="HexBin Installation [1]" />

    <Directory Id='TARGETDIR' Name='SourceDir'>
      <Directory Id='ProgramFilesFolder' Name='PFiles'>
          <Directory Id='INSTALLDIR' Name='HexBin'>

            <Component Id='MainExecutable' Guid='9FDA655E-DB2B-44CB-A92E-0F32DCFFF881'>
              <File Id='HexBinEXE' Name='HexBin.exe' DiskId='1' Source='..\Release\HexBin.exe' KeyPath='yes'>
                <Shortcut Id="startmenuHexBin" Directory="ProgramMenuDir" Name="HexBin $(var.Version)" WorkingDirectory='INSTALLDIR' Icon="HexBin.exe" IconIndex="0" Advertise="yes" />
                <Shortcut Id="desktopHexBin" Directory="DesktopFolder" Name="HexBin $(var.Version)" WorkingDirectory='INSTALLDIR' Icon="HexBin.exe" IconIndex="0" Advertise="yes" />
              </File>
            </Component>

            <Component Id='LICENSE' Guid='B66C9BA8-4FF1-4075-B2F5-CCF50B33EF74'>
              <File Id='LICENSE' Name='LICENSE.txt' DiskId='1' Source='LICENSE.txt' KeyPath='yes'>
              </File>
            </Component>
            
        </Directory>
      </Directory>

      <Directory Id="ProgramMenuFolder" Name="Programs">
        <Directory Id="ProgramMenuDir" Name="HexBin $(var.Version)">
          <Component Id="ProgramMenuDir" Guid="3FDA655E-DB2B-44CB-A9CE-0F32DCFFF885">
            <RemoveFolder Id='ProgramMenuDir' On='uninstall' />
            <RegistryValue Root='HKCU' Key='Software\[Manufacturer]\[ProductName]' Type='string' Value='' KeyPath='yes' />
          </Component>
        </Directory>
      </Directory>

      <Directory Id="DesktopFolder" Name="Desktop" />
    </Directory>
    <Feature Id='Complete' Level='1'>
      <ComponentRef Id='MainExecutable' />
      <ComponentRef Id='ProgramMenuDir' />
      <ComponentRef Id='LICENSE' />
    </Feature>
    <Icon Id="HexBin.exe" SourceFile="..\Release\HexBin.exe" />
    <Property Id="ARPPRODUCTICON" Value="HexBin.exe" />
    <Upgrade Id="$(var.UpgradeCode)">
      <UpgradeVersion Minimum="$(var.FullVersion)"
                      IncludeMinimum="no"
                      OnlyDetect="yes"
                      Language="1033"
                      Property="NEWPRODUCTFOUND" />
      <UpgradeVersion Minimum="$(var.FirstVersion)"
                      IncludeMinimum="yes"
                      Maximum="$(var.FullVersion)"
                      IncludeMaximum="no"
                      Language="1033"
                      Property="UPGRADEFOUND" />
    </Upgrade>
    <CustomAction Id="PreventDowngrading" Error="Newer version already installed." />
    <InstallExecuteSequence>
      <Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
      <RemoveExistingProducts After="InstallFinalize" />
    </InstallExecuteSequence>

    <InstallUISequence>
      <Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
    </InstallUISequence>
    
  </Product>
  
</Wix>
